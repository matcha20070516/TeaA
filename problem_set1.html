<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>問題</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      background: #f6f8fb;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
      padding: 30px;
      width: 90%;
      max-width: 600px;
      text-align: center;
      position: relative;
    }

    .chapters {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .chapter-btn {
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      background-color: #eee;
      cursor: pointer;
    }

    .chapter-btn.current {
      background-color: #5da3fa;
      color: white;
    }

    .chapter-btn.answered {
      background-color: #4caf50;
      color: white;
    }

    h2 {
      margin-bottom: 16px;
      color: #444;
    }

    .question-box {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 16px;
    }

    img {
      width: 100%;
      max-width: 300px;
      max-height: 250px;
      object-fit: contain;
      border-radius: 8px;
    }

    .nav-btn {
      font-size: 2em;
      color: #5da3fa;
      cursor: pointer;
      user-select: none;
    }

    .answer-container {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 20px;
    }

    input[type="text"]:disabled {
      background-color: #f0f0f0;
      color: #999;
    }

    input[type="text"] {
      flex: 1;
      padding: 10px;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    button {
      background-color: #5da3fa;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 1em;
      border-radius: 8px;
      cursor: pointer;
    }

    button:hover {
      background-color: #3c84e6;
    }

    #question-num {
      margin-bottom: 10px;
      color: #666;
    }

    .message {
      margin-top: 10px;
      font-size: 1em;
      color: #e53935;
    }

    .timer {
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 1.2em;
      color: #444;
    }

    .pass-button {
      position: absolute;
      top: 10px;
      left: 20px;
      font-size: 1em;
      padding: 6px 12px;
      background: #ccc;
      border-radius: 8px;
      cursor: pointer;
    }

    .pass-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 20px 40px;
      border-radius: 12px;
      font-size: 1.5em;
      display: none;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="pass-button" onclick="pass()">パス</div>
    <div class="timer" id="timer">00:00:00</div>
    <div id="question-num">第1問</div>

    <div class="chapters" id="chapters"></div>

    <div class="question-box">
      <span id="back-btn" class="nav-btn" onclick="back()">◁</span>
      <img id="quiz-img" src="q1.png" alt="問題画像">
      <span id="forward-btn" class="nav-btn" onclick="forward()">▷</span>
    </div>

    <div class="answer-container">
      <input type="text" id="answer" placeholder="答えを入力">
      <button onclick="checkAnswer()">解答</button>
    </div>
    <div class="message" id="message"></div>

    <div class="pass-overlay" id="pass-overlay">パス！ +60秒</div>
  </div>

  <script>
    const total = 5;
    let current = 1;
    let passes = 0;
    let startTime = Date.now();
    let addedPenalty = 0;
    let maxReached = 1;

    const answers = ["りんご", "みかん", "ぶどう", "もも", "すいか"];
    const answerStates = Array(total).fill(null);
    const locked = Array(total).fill(false);

    function loadQuestion() {
      document.getElementById("question-num").textContent = `第${current}問`;
      document.getElementById("quiz-img").src = `q${current}.png`;

      const input = document.getElementById("answer");
      input.value = answerStates[current - 1] || "";
      input.disabled = locked[current - 1];
      document.getElementById("message").textContent = "";
      updateNavButtons();
      updateChapters();
    }

    function updateNavButtons() {
      document.getElementById("back-btn").style.visibility = current > 1 ? "visible" : "hidden";
      document.getElementById("forward-btn").style.visibility =
        current < maxReached && current < total ? "visible" : "hidden";
    }

    function updateChapters() {
      const chapterContainer = document.getElementById("chapters");
      chapterContainer.innerHTML = "";
      for (let i = 0; i < total; i++) {
        const btn = document.createElement("button");
        btn.textContent = `${i + 1}`;
        btn.className = "chapter-btn";
        if (i + 1 === current) btn.classList.add("current");
        if (locked[i]) btn.classList.add("answered");
        btn.disabled = i + 1 > maxReached;
        btn.onclick = () => {
          current = i + 1;
          loadQuestion();
        };
        chapterContainer.appendChild(btn);
      }
    }

    function checkAnswer() {
      const input = document.getElementById("answer");
      const userAnswer = input.value.trim();
      answerStates[current - 1] = userAnswer;

      const correct = answers[current - 1];
      const normalized = userAnswer.replace(/\s/g, "").replace(/[ー－]/g, "").toLowerCase();
      const correctNormalized = correct.replace(/\s/g, "").replace(/[ー－]/g, "").toLowerCase();

      if (normalized === correctNormalized) {
        document.getElementById("message").textContent = "正解！";
        locked[current - 1] = true;
        input.disabled = true;
        if (current === maxReached) maxReached++;
        setTimeout(() => {
          if (current < total) {
            current++;
            loadQuestion();
          } else {
            finish();
          }
        }, 500);
      } else {
        document.getElementById("message").textContent = "不正解…もう一度試してみよう";
      }
    }

    function back() {
      if (current > 1) {
        current--;
        loadQuestion();
      }
    }

    function forward() {
      if (current < maxReached && current < total) {
        current++;
        loadQuestion();
      }
    }

    function pass() {
      passes++;
      addedPenalty += 60; // 60秒加算
      showPassOverlay();

      if (current === maxReached && current < total) maxReached++;
      if (current < total) {
        current++;
        loadQuestion();
      } else {
        finish();
      }
    }

    function showPassOverlay() {
      const overlay = document.getElementById("pass-overlay");
      overlay.style.display = "block";
      setTimeout(() => {
        overlay.style.display = "none";
      }, 1000);
    }

    function finish() {
      const totalTime = Date.now() - startTime + addedPenalty * 1000;
      sessionStorage.setItem("passes", passes);
      sessionStorage.setItem("time", totalTime);
      window.location.href = "result.html";
    }
    
    function updateTimer() {
      elapsedRaw = Date.now() - startTime + addedPenalty * 1000; // 経過時間の更新

      // 分、秒、百秒の計算
      let minutes = Math.floor(elapsedRaw / 60000); // 分の計算
      let seconds = Math.floor((elapsedRaw % 60000) / 1000); // 秒の計算
      let hundredths = Math.floor((elapsedRaw % 1000) / 10); // 百秒の計算

      // 結果を表示（分：秒：百秒）
      document.getElementById("timer").textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(hundredths).padStart(2, '0')}`;
    }
  </script>
  <script>
  function adjustViewportHeight() {
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
  }

  window.addEventListener('resize', adjustViewportHeight);
  window.addEventListener('load', adjustViewportHeight);
</script>
</body>
</html>
